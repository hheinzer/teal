#!/bin/bash
shopt -s extglob

ncores=$1 # number of cores (for example: "1 2 3 4")
prog=$2 # program
args=${@:3} # program arguments

out=$prog.out

for n in $ncores
do
    sleep 60
    mpirun -n $n $prog > $out
    echo $n $(awk '/computation time/ {print $4}' $out) | tee -a tmp

    dir=${prog}_$n
    mkdir -p $dir
    mv $prog!(*benchmark*).* $dir
done

mv tmp ${prog}_benchmark.out
