#!/bin/bash
shopt -s extglob

prog=$1 # program
ncores=${@:2} # number of cores

out=$prog.out

for n in $ncores
do
    mpirun -n $n $prog > $out
    echo $n $(awk '/computation time/ {print $4}' $out) | tee -a tmp

    dir=${prog}_$n
    mkdir -p $dir
    mv $prog!(*benchmark*).* $dir
done

mv tmp ${prog}_benchmark.out
